<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

	<head>
	  <title>Tasks to do</title>
	  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	  <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}"/>
	  <!-- Bootstrap -->
	  <link href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" />
	
	  <script>
	  	
		function clicked_delete() {
	       if (confirm('Do you want to delete the task?')) {
	           yourformelement.submit();
	       } else {
			   event.preventDefault();
	           return false;
	       }
	    }
	    
		function clicked_delete_all() {
	       if (confirm('Do you want to delete all the tasks?')) {
	           yourformelement.submit();
	       } else {
	            event.preventDefault();
				return false;
	       }
	    }
	    
	  </script>
	</head>

	<body onload="test() ;">
		<div th:replace="fragments/header :: header"/>		
		<div class="container">
			<div class="content-wrap">
				<!-- Body -->
				    <h3><span th:utext="${username}"></span>'s tasks</h3>
				    <hr/>
					<form style="display: inline" th:object="${userId}" th:action="@{/add}" method="GET">
						<input type="hidden" name="userId" th:value="${userId}"/>
				        <button type="submit" class="btn btn-primary">Add</button>
				    </form> 
					<form style="display: inline" th:action="@{/update}" th:object="${items}" method="POST">
				        <button type="submit" name="deleteall" onclick="clicked_delete_all();" class="btn btn-primary">Remove All</button>
				    </form>
					<form style="display: inline; float:right" th:action="@{/tasks}" method="GET">
						<input type="text" th:name="search" th:value="${search}" placeholder="Task name or description"/>
				        <button type="submit" class="btn btn-primary">Search</button>
				    </form>
					<br/> <br/>
				    <div class="todoList" th:if="${items.taskList.size()} != 0">
				        <table class="table table-bordered table-striped" id="todoItems">
				         <colgroup>
					       <col span="1" style="width: 15%;">
					       <col span="1" style="width: 20%;">
					       <col span="1">
						   <col span="1" style="width: 15%;">
						   <col span="1" style="width: 15%;">
					    </colgroup> 
						 <thead>
				            <tr>
				              <th>Modify</th>
				              <th>Name</th>
				              <th>Description</th>
				              <th>Deadline</th>
				              <th>Attachment</th>
				            </tr>
				          </thead>
					      <tbody>
				            <tr th:each="item,i : ${items.taskList}" th:class="${item.complete}? active : warning">
				              <form class="form-horizontal" th:action="@{/update}" role="form" th:object="${item}" method="POST">
								<input type="hidden" th:field="${items.taskList[__${i.index}__].id}" />
								<td>
				                  <ul style="list-style-type:none">
									<li th:if="*{complete}">
										<input type="image" name="done" th:src="@{/images/check.png}"
											alt="Submit Form" width="13" height="13"/> 
											&nbsp;done </li>
											
									<li th:if="*{complete} == false">
										<input type="image" name="done" th:src="@{/images/uncheck.png}"
											alt="Submit Form" width="13" height="13"/>
											&nbsp;done </li>
									<li>
										<input type="image" name="edit" th:src="@{/images/edit.png}"
											alt="Submit Form" width="13" height="13"/> 
									  &nbsp;edit 
						            </li>
									<li th:if="${true}">
						              <input type="image" name="delete" th:src="@{/images/delete.png}"
											onclick="clicked_delete()" alt="Submit Form" width="13" height="13"/>
									  &nbsp;delete&nbsp;
						            </li>
						         </ul>
				              </td>				              
							  <td th:text="*{name}"></td>
							  <input type="hidden" th:field="${items.taskList[__${i.index}__].name}" />
				              <td th:text="*{description}"></td>
							  <input type="hidden" th:field="${items.taskList[__${i.index}__].description}" />
				              <td th:text="*{deadline}"></td>
							  <input type="hidden" th:field="${items.taskList[__${i.index}__].deadline}" />
				              <td> 
								<ul style="list-style-type:none">
									<li th:if="*{fileName} != null">
						              <input type="image" id="doDownload" th:src="@{/images/download.png}"
											name="download" alt="Submit Form" width="13" height="13"/>
										&nbsp;download
						            </li>
									<li th:if="*{fileName} != null">
						              <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>
										&nbsp; <span th:utext="*{fileName}"/> 
						            </li>
									<li th:if="*{fileName} != null"> &nbsp;
									  	<span th:utext="${item.fileSizeOnSystem}"/> bytes </li>
						         </ul>
				              </td>
							 </form>
				            </tr>
				          </tbody>
				        </table>		
				</div>	
				<div align="center" th:if="${items.taskList.size()} == 0">
		            <p style="font-size: 30; text-decoration: underline;">No tasks found to show</p>
		        </div> 
			</div>
		</div>
   		  	
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
		<script src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.2.0/bootstrap.min.js"></script>
		
		<div th:replace="fragments/footer :: footer"/>		
				
	</body>

</html>